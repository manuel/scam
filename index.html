<html>
<head>
  <title>scam</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
  <script type="text/javascript" src="../wat-js/wat.js"></script>
  <script type="text/javascript" src="../wat-js/wat-basics.js"></script>
  <style>
    html { font-family: sans; }
    .box {
        margin: 0em .25em; padding: 0 .25em; display: inline-table;
        border-left: 2px solid #ccc;
        border-right: 2px solid #ccc;
        border-radius: 0.5em;
    }
    .line { padding-left: 0.5em; }
    .firstLine { margin-left: 0; }
    .text { display: inline; margin: 0 .25em;}
    .h { display: inline; font-weight: bold; margin: 0 .25em;}

  </style>
</head>
<body>
<h1><a href="https://github.com/manuel/scam">scam</a></h1>
<script type="text/javascript">
var code = 
    ["begin",
     wat_basics.main,
     ["define-macro", ["text", "str"],
      ["list", "make-text", ["list", "string", "str"]]],
     ["define", ["make-text", "str"],
      ["let", [["div", ["#", "createElement", document, ["string", "div"]]]],
       ["#", "setAttribute", "div", ["string", "class"], ["string", "text"]],
       ["#", "appendChild", "div", ["#", "createTextNode", document, "str"]],
       "div"]],
     ["define-macro", ["h", "str"],
      ["list", "make-h", ["list", "string", "str"]]],
     ["define", ["make-h", "str"],
      ["let", [["div", ["#", "createElement", document, ["string", "div"]]]],
       ["#", "setAttribute", "div", ["string", "class"], ["string", "h"]],
       ["#", "appendChild", "div", ["#", "createTextNode", document, "str"]],
       "div"]],
     ["define", ["box", "first", "#rest", "elts"],
      ["let", [["div", ["#", "createElement", document, ["string", "div"]]]],
       ["#", "setAttribute", "div", ["string", "class"], ["string", "box"]],
       ["#", "setAttribute", "first", ["string", "class"],
        ["+",
         ["#", "getAttribute", "first", ["string", "className"]],
         ["string", " firstLine"]]],
       ["#", "appendChild", "div", "first"],
       ["map-list", ["lambda", ["elt"], ["#", "appendChild", "div", "elt"]], "elts"],
       "div"]],
     ["define", ["line", "#rest", "elts"],
      ["let", [["div", ["#", "createElement", document, ["string", "div"]]]],
       ["#", "setAttribute", "div", ["string", "class"], ["string", "line"]],
       ["if", ["nil?", "elts"],
        ["js-set-element", "div", ["string", "innerHTML"], ["string", "&nbsp;"]],
        ["map-list", ["lambda", ["elt"], ["#", "appendChild", "div", "elt"]], "elts"]],
       "div"]],

     ["define", "LET-SAMPLE",
      ["box",
       ["line",
        ["box",
         ["line",
          ["text", "let"],
          ["box", ["line",
                   ["box", ["line", ["text", "x"], ["text", "1"]]],
                   ["box", ["line", ["text", "y"], ["text", "2"]]]]]],
         ["line",
          ["box", ["line", ["text", "+"], ["text", "x"], ["text", "y"]]]]]],
       ["line",
        ["box",
         ["line",
          ["h", "Hello world!"]],
         ["line",
          ["box", ["line", ["text", "Iteratee IO is a style of incremental input processing with precise resource control. The style encourages building input processors from a user-extensible set of primitives by chaining, layering, pairing and other modes of compositions. The programmer is still able, where needed, to precisely control look-ahead, the allocation of buffers, file descriptors and other resources."]]],
          ["box", ["line", ["text", "This is a sample document."]]],
          ["text", "This is a sample document."],
          ["line", ["box", ["line", ["text", "This is a sample document."]]]],
          ["line", ["box", ["line", ["text", "This is a sample "]]]],
          ["line", ["box",
                    ["line", ["h", "This is a sample document."]],
                    ["line", ["box", ["line", ["text", "The proper implementation of undelimited continuations is surprisingly tricky. In particular, the Cont monad in Haskell's monad transformer library has a couple of imperfections."]]]],
                    ["line", ["box", ["line", ["text", "Recall that monad is a technique of embedding an impure, object language, into a pure functional (meta)language. For an object language with control effects, the well-known embedding technique is continuation-passing style (CPS) -- which is what all our monads implement. "]]]],
                    ["line", ["box", ["line", ["text", "This is a sample "]]]],
                    ["line", ["box", ["line", ["text", "This is a sample "]]]],
                    ["line", ["box", ["line", ["text", "This is a sample "]]]],
                    ["line", ["box", ["line", ["text", "This is a sample "]]]]]]]]]]],
     ["#", "appendChild", [".", "body", document], "LET-SAMPLE"],

    ];
console.log(new wat.VM().run(code));
</script>
</body>
</html>
